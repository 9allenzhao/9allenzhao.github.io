<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>OpenStack Ceilometer数据与API源码详解 | Allen&#39;s BLOG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="OpenStack Ceilometer存储默认使用MongoDB，Collector对它进行写操作，API对它进行读操作">
<meta name="keywords" content="Ceilometer,OpenStack,Source,API">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenStack Ceilometer数据与API源码详解">
<meta property="og:url" content="https://9allenzhao.github.io/2017/06/20/tech/2013-06-12-hacking-in-openstack-ceilometer-api/index.html">
<meta property="og:site_name" content="Allen&#39;s BLOG">
<meta property="og:description" content="OpenStack Ceilometer存储默认使用MongoDB，Collector对它进行写操作，API对它进行读操作">
<meta property="og:updated_time" content="2017-06-20T06:35:12.403Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenStack Ceilometer数据与API源码详解">
<meta name="twitter:description" content="OpenStack Ceilometer存储默认使用MongoDB，Collector对它进行写操作，API对它进行读操作">
  
  
    <link rel="icon" href="/img/avatar.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="/css/hl_theme/darcula.css">
  
  <link href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script src="/js/jquery.autocomplete.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
    <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
  
</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_duoshuo_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_duoshuo_domain" value="jaytp">
</div>
<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar" style="background-image:url(/img/avatar.jpg)"></a>
<div class="author">
    <span>Allen</span>
</div>
<div class="icon">
    
    <a class="rss" title="rss" href="/atom.xml" target="_blank"></a>
    
    
    
    
    
    
    
    
    
    <a class="email" title="email" href="mailto:9allenzhao@gmail.com"></a>
    
</div>
<ul>
    <li class="all active">全部文章</li>
    
    <li data-rel="读书"> 读书 </li>
    
    <li data-rel="技术"> 技术 </li>
    
    <li data-rel="资源"> 资源 </li>
    
    <li data-rel="工具"> 工具 </li>
    
</ul>
<input type="hidden" id="yelog_site_posts_number" value="107">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>
    </div>
    <div class="nav-right">
        <form onkeydown="if(event.keyCode==13){return false;}">
    <input class="search" type="text" placeholder="Search..." autocomplete="off">
    <i class="cross"></i>
    <span>
        <label for="tagswitch">Tags:</label>
        <input id="tagswitch" type="checkbox">
    </span>
</form>
<ul class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">PHP</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">JavaScript</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">OpenStack</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">Python</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Virtualization</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Concept</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">HTML</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">CSS</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">Apache</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">Git</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Nginx</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Laravel</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">MySQL</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">Mac</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">算法</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">React</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Bootstrap</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">jQuery</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">SVN</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Shell</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">SEO</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">Vim</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Windows</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Sublime</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">Jekyll</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Blog</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Tool</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">MongoDB</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Tools</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Vagrant</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">Docker</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Pattern</a>
    </li>
    
    <div class="clearfix"></div>
</ul>

<nav>
    
    <a  class=""
       href="/2017/06/20/hello-world/"
       data-tag=""
       data-author="" >
        <span class="post-title" title="Hello World">Hello World</span>
        <span class="post-date" title="2017-06-20 15:20:58">2017/06/20</span>
    </a>
    
    <a  class="读书 "
       href="/2017/06/20/book/2013-12-20-book-list-of-2013/"
       data-tag=""
       data-author="" >
        <span class="post-title" title="2013阅读书单">2013阅读书单</span>
        <span class="post-date" title="2017-06-20 15:23:40">2017/06/20</span>
    </a>
    
    <a  class="读书 "
       href="/2017/06/20/book/2014-03-14-book-list-of-2014/"
       data-tag=""
       data-author="" >
        <span class="post-title" title="2014阅读书单">2014阅读书单</span>
        <span class="post-date" title="2017-06-20 15:23:40">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2012-09-19-php-session-security/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="PHP Session 原理及安全性提升">PHP Session 原理及安全性提升</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2012-09-27-open-widown-in-javascript/"
       data-tag="JavaScript"
       data-author="" >
        <span class="post-title" title="JS中防止浏览器屏蔽window.open">JS中防止浏览器屏蔽window.open</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2012-09-27-php-variable-variables/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="PHP可变变量">PHP可变变量</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-01-30-command-of-kanyun/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="kanyun的api-client命令">kanyun的api-client命令</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2012-11-08-openstack-nova-internal/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Nova内部机制【译】">OpenStack Nova内部机制【译】</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-01-30-deploy-kanyun/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="在OpenStack中部署kanyun">在OpenStack中部署kanyun</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2012-12-31-python-development-of-sae/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="sae下的python开发部署和一个简单例子">sae下的python开发部署和一个简单例子</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-01-30-introduction-kanyun-server/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="kanyun server服务">kanyun server服务</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-03-20-debug-and-modify-openstack-horizon/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="调试和修改OpenStack中的Horizon部分">调试和修改OpenStack中的Horizon部分</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-01-30-introduction-of-kanyun-worker/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="kanyun worker原理">kanyun worker原理</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-02-24-javascript-variable-domain/"
       data-tag="JavaScript"
       data-author="" >
        <span class="post-title" title="JavaScript变量作用域">JavaScript变量作用域</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-03-20-different-bewteen-kvm-xen-qemu/"
       data-tag="Virtualization"
       data-author="" >
        <span class="post-title" title="虚拟化中KVM, Xen, Qemu的区别">虚拟化中KVM, Xen, Qemu的区别</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-03-21-introduction-of-ceilometer/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Ceilometer项目简介">OpenStack Ceilometer项目简介</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-03-21-vnc-vs-rdp/"
       data-tag="Virtualization"
       data-author="" >
        <span class="post-title" title="VNC和远程桌面的区别">VNC和远程桌面的区别</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-04-23-opensource-licenses/"
       data-tag="Concept"
       data-author="" >
        <span class="post-title" title="五种常见的开源协议整理">五种常见的开源协议整理</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-03-27-glossary-of-ceilometer/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Ceilometer的一些术语">OpenStack Ceilometer的一些术语</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-04-25-conceptual-logical-physical/"
       data-tag="Concept"
       data-author="" >
        <span class="post-title" title="概念模型、逻辑模型、物理模型的区别">概念模型、逻辑模型、物理模型的区别</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-04-25-some-concept-about-enterprise-storage/"
       data-tag="Concept"
       data-author="" >
        <span class="post-title" title="几种企业的存储系统">几种企业的存储系统</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-04-26-create-windows-xp-image-for-openstack/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="给OpenStack创建Windows XP镜像">给OpenStack创建Windows XP镜像</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-01-terminal-command-of-ceilometer/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="Ceilometer的命令行使用">Ceilometer的命令行使用</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-01-deploy-a-ceilometer-horizon-project/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="部署一个ceilometer-horizon项目">部署一个ceilometer-horizon项目</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-03-create-windows-7-image-for-openstack/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="给OpenStack创建Win7镜像">给OpenStack创建Win7镜像</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-03-php-cache-of-a-page/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="页面提速之——数据缓存">页面提速之——数据缓存</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-06-interactive-coding-ipython/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="交互式编程-IPython">交互式编程-IPython</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-06-the-viewpoint-metatag/"
       data-tag="HTML"
       data-author="" >
        <span class="post-title" title="HTML中meta标签viewpoint的作用">HTML中meta标签viewpoint的作用</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-06-why-use-pip-over-easy-install/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="为什么使用pip而不是easy_install">为什么使用pip而不是easy_install</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-15-create-ubuntu-image-for-openstack/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="给OpenStack创建Ubuntu镜像">给OpenStack创建Ubuntu镜像</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-13-openstack-grizzly-multihost-deployment-doc/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Grizzly Multihost部署文档">OpenStack Grizzly Multihost部署文档</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-15-different-between-python-package-tools/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="python包工具之间的关系">python包工具之间的关系</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-15-learn-how-to-use-distutils/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="学习使用python打包工具distutils">学习使用python打包工具distutils</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-16-deploy-openstack-grizzly-in-virtual-machine/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="在虚拟机单机部署OpenStack Grizzly">在虚拟机单机部署OpenStack Grizzly</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-19-what-is-wsgi/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="WSGI学习">WSGI学习</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-27-openstack-horizon-locale/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Horizon 中文本地化">OpenStack Horizon 中文本地化</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-07-learn-python-setuptools-in-detail/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="Python包管理工具setuptools详解">Python包管理工具setuptools详解</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-09-learn-python-abc-module/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="学习Python的ABC模块">学习Python的ABC模块</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-09-learn-python-stevedore-module-in-detail/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="学习Python动态扩展包stevedore">学习Python动态扩展包stevedore</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-11-pipeline-of-openstack-ceilometer/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Ceilometer Pipeline代码解读">OpenStack Ceilometer Pipeline代码解读</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-12-hacking-in-openstack-ceilometer-api/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Ceilometer数据与API源码详解">OpenStack Ceilometer数据与API源码详解</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-11-hacking-in-openstack-ceilometer-compute-agent/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Ceilometer Agent源码解读">OpenStack Ceilometer Agent源码解读</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-12-hacking-in-openstack-ceilometer-collector/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Ceilometer Collector代码解读">OpenStack Ceilometer Collector代码解读</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-10-01-deploy-ceilometer-of-openstack/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="部署Ceilometer到已有环境中">部署Ceilometer到已有环境中</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-12-08-implemention-of-breadcrumbs-by-css3/"
       data-tag="CSS"
       data-author="" >
        <span class="post-title" title="基于CSS3实现尖角面包屑">基于CSS3实现尖角面包屑</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-01-17-python-script-of-sae-log-download/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="Python脚本--下载合并SAE日志">Python脚本--下载合并SAE日志</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-01-16-php-namespace-and-autoload/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="PHP命名空间及自动加载">PHP命名空间及自动加载</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-01-25-how-to-use-php-socket/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="PHP Socket的使用">PHP Socket的使用</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-01-24-apache-log-format/"
       data-tag="Apache"
       data-author="" >
        <span class="post-title" title="Apache 日志文件格式及简单处理">Apache 日志文件格式及简单处理</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-01-30-understanding-the-github-workflow/"
       data-tag="Git"
       data-author="" >
        <span class="post-title" title="了解GitHub工作流【译】">了解GitHub工作流【译】</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-02-15-apache-and-nginx/"
       data-tag="Apache,Nginx"
       data-author="" >
        <span class="post-title" title="从运行原理及使用场景看Apache和Nginx">从运行原理及使用场景看Apache和Nginx</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-03-10-grunt-bower-and-laravel/"
       data-tag="PHP,Laravel"
       data-author="" >
        <span class="post-title" title="用Laravel+Grunt+Bower管理你的应用">用Laravel+Grunt+Bower管理你的应用</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-03-20-use-other-libraries-in-laravel/"
       data-tag="PHP,Laravel"
       data-author="" >
        <span class="post-title" title="在Laravel中使用自己的类库三种方式">在Laravel中使用自己的类库三种方式</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-04-11-redis-queue-in-laravel/"
       data-tag="Laravel"
       data-author="" >
        <span class="post-title" title="Laravel中用Redis来做任务队列">Laravel中用Redis来做任务队列</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-03-22-managing-your-larrvel-queue-by-supervisor/"
       data-tag="PHP,Laravel"
       data-author="" >
        <span class="post-title" title="使用Supervisor来管理你的Laravel队列">使用Supervisor来管理你的Laravel队列</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-04-16-insert-large-number-of-data-in-mysql/"
       data-tag="MySQL"
       data-author="" >
        <span class="post-title" title="MySQL大量数据插入方法性能分析比较">MySQL大量数据插入方法性能分析比较</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-04-23-roc-curve/"
       data-tag="Concept"
       data-author="" >
        <span class="post-title" title="ROC曲线">ROC曲线</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-05-04-set-environment-variables-of-server-for-php/"
       data-tag="PHP,Apache,Nginx"
       data-author="" >
        <span class="post-title" title="设置PHP服务器Apache和Nginx环境变量">设置PHP服务器Apache和Nginx环境变量</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-04-27-magic-methods-and-magic-constants-in-php/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="PHP中的魔术方法和魔术常量简介和使用">PHP中的魔术方法和魔术常量简介和使用</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-09-26-use-old-version-of-brew-php/"
       data-tag="PHP,Mac"
       data-author="" >
        <span class="post-title" title="回退Mac上用Brew安装的PHP版本">回退Mac上用Brew安装的PHP版本</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-12-06-ioc-and-facade-in-laravel/"
       data-tag="PHP,Laravel"
       data-author="" >
        <span class="post-title" title="Laravel核心之IOC和Facade">Laravel核心之IOC和Facade</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2015-09-07-sort-algorithms/"
       data-tag="算法"
       data-author="" >
        <span class="post-title" title="七种常见经典排序算法总结（C++实现）">七种常见经典排序算法总结（C++实现）</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2015-01-08-conflict-between-camel-and-snake-in-laravel/"
       data-tag="PHP,Laravel"
       data-author="" >
        <span class="post-title" title="Laravel关联模型名称一致性问题">Laravel关联模型名称一致性问题</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2017-02-19-setup-react-environment/"
       data-tag="React"
       data-author="" >
        <span class="post-title" title="React 学习 - 开发环境搭建">React 学习 - 开发环境搭建</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2013-04-23-general-bootstrap-resources/"
       data-tag="Bootstrap"
       data-author="" >
        <span class="post-title" title="Bootstrap常用资源">Bootstrap常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-html-resources/"
       data-tag="HTML"
       data-author="" >
        <span class="post-title" title="HTML 常用资源">HTML 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-git-resources/"
       data-tag="Git"
       data-author="" >
        <span class="post-title" title="Git 常用资源">Git 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-javascript-resources/"
       data-tag="JavaScript"
       data-author="" >
        <span class="post-title" title="JavaScript 常用资源">JavaScript 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-jquery-resources/"
       data-tag="jQuery"
       data-author="" >
        <span class="post-title" title="jQuery 常用资源">jQuery 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-php-resources/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="PHP 常用资源">PHP 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-python-resources/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="Python 常用资源">Python 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-svn-resources/"
       data-tag="SVN"
       data-author="" >
        <span class="post-title" title="SVN 常用资源">SVN 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-shell-resources/"
       data-tag="Shell"
       data-author="" >
        <span class="post-title" title="Shell 常用资源">Shell 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-05-11-general-mysql-resources/"
       data-tag="MySQL"
       data-author="" >
        <span class="post-title" title="MySQL常用资源">MySQL常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-08-03-general-mac-resources/"
       data-tag="Mac"
       data-author="" >
        <span class="post-title" title="Mac 常用资源">Mac 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2015-02-13-general-seo-resources/"
       data-tag="SEO"
       data-author="" >
        <span class="post-title" title="SEO 常用资源">SEO 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2015-10-04-general-vim-resources/"
       data-tag="Vim"
       data-author="" >
        <span class="post-title" title="Vim 常用资源">Vim 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2012-12-30-share-windows-and-linux/"
       data-tag="Windows,Linux"
       data-author="" >
        <span class="post-title" title="Windows和Linux切换最终解决方案">Windows和Linux切换最终解决方案</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-01-09-remote-access-of-mysql/"
       data-tag="MySQL"
       data-author="" >
        <span class="post-title" title="MySQL远程访问">MySQL远程访问</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-01-16-create-remote-resp/"
       data-tag="Git"
       data-author="" >
        <span class="post-title" title="git创建远程库">git创建远程库</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-02-25-quick-open-in-windows/"
       data-tag="Windows"
       data-author="" >
        <span class="post-title" title="win7快速打开应用程序或文件">win7快速打开应用程序或文件</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-03-25-open-tcp-port-of-libvirt/"
       data-tag="Linux"
       data-author="" >
        <span class="post-title" title="Linux下开启Libvirtd的tcp监控">Linux下开启Libvirtd的tcp监控</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-03-25-tools-of-sever-deployment/"
       data-tag="Linux"
       data-author="" >
        <span class="post-title" title="服务器自动化部署及运维常见工具">服务器自动化部署及运维常见工具</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-04-21-add-snippet/"
       data-tag="Sublime"
       data-author="" >
        <span class="post-title" title="给sublime增加snippet">给sublime增加snippet</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-04-22-add-svn-ignore-file/"
       data-tag="SVN"
       data-author="" >
        <span class="post-title" title="给SVN控制的项目添加忽略文件/文件夹">给SVN控制的项目添加忽略文件/文件夹</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-04-22-highlight-of-jekyll/"
       data-tag="Jekyll"
       data-author="" >
        <span class="post-title" title="Jekyll的中的代码高亮">Jekyll的中的代码高亮</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-04-22-ignore-password-in-git-push/"
       data-tag="Git"
       data-author="" >
        <span class="post-title" title="让git push命令不再需要密码">让git push命令不再需要密码</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-04-22-wordpress-to-jekyll/"
       data-tag="Blog"
       data-author="" >
        <span class="post-title" title="博客迁移完成">博客迁移完成</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-05-20-set-proxy-for-git-or-apt/"
       data-tag="Git"
       data-author="" >
        <span class="post-title" title="给Git或者APT设置goagent代理">给Git或者APT设置goagent代理</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-05-22-change-to-zsh/"
       data-tag="Mac"
       data-author="" >
        <span class="post-title" title="从Bash切换到Zsh">从Bash切换到Zsh</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-08-04-something-about-tools-i-used/"
       data-tag="Tool"
       data-author="" >
        <span class="post-title" title="我与工具">我与工具</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-05-23-install-mysql-and-mongo-web-admin/"
       data-tag="MySQL,Linux,MongoDB"
       data-author="" >
        <span class="post-title" title="安装MySQL和MongoDB的WEB管理界面">安装MySQL和MongoDB的WEB管理界面</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-08-06-tools-of-reading/"
       data-tag="Tool"
       data-author="" >
        <span class="post-title" title="我与工具--阅读和知识管理">我与工具--阅读和知识管理</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-08-28-change-bootstrap-to-3/"
       data-tag="Blog"
       data-author="" >
        <span class="post-title" title="更新前端框架到Bootstrap3">更新前端框架到Bootstrap3</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-12-08-linux-command-continue/"
       data-tag="Linux"
       data-author="" >
        <span class="post-title" title="Linux下多个命令连续执行方法">Linux下多个命令连续执行方法</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-12-11-deploy-pptp-vpn-in-ubuntu/"
       data-tag="Linux"
       data-author="" >
        <span class="post-title" title="在ubuntu下搭建pptp vpn服务器">在ubuntu下搭建pptp vpn服务器</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-12-11-lamp-in-mac/"
       data-tag="PHP,Mac,MongoDB"
       data-author="" >
        <span class="post-title" title="Mac下用brew搭建LNMP和LAMP开发环境">Mac下用brew搭建LNMP和LAMP开发环境</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2014-02-12-how-to-deploy-a-blog-on-github-by-jekyll/"
       data-tag="Jekyll"
       data-author="" >
        <span class="post-title" title="在Github上搭建Jekyll博客和创建主题">在Github上搭建Jekyll博客和创建主题</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2014-03-20-php-debug-with-xdebug/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="用Xdebug和Sublime调试PHP代码">用Xdebug和Sublime调试PHP代码</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2015-01-10-use-dropzone-and-qiniu-to-store-blog-images/"
       data-tag="Blog"
       data-author="" >
        <span class="post-title" title="使用Dropzone和七牛优化博客图床">使用Dropzone和七牛优化博客图床</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2016-11-09-my-writing-tools/"
       data-tag="Tools"
       data-author="" >
        <span class="post-title" title="我使用的收藏，写作和分享工具">我使用的收藏，写作和分享工具</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2014-04-10-install-vagrant-in-mac/"
       data-tag="Mac,Vagrant"
       data-author="" >
        <span class="post-title" title="在Mac下安装使用Vagrant">在Mac下安装使用Vagrant</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2016-12-30-deploy-l2tp-on-ubuntu/"
       data-tag="Tools"
       data-author="" >
        <span class="post-title" title="在 Ubuntu 下部署 L2TP VPN">在 Ubuntu 下部署 L2TP VPN</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2016-12-31-deploy-shadowsocks-on-ubuntu/"
       data-tag="Tools"
       data-author="" >
        <span class="post-title" title="在 Ubuntu 下部署 Shadowsocks">在 Ubuntu 下部署 Shadowsocks</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2017-01-14-install-hhvm-on-mac-with-docker/"
       data-tag="Mac,Docker"
       data-author="" >
        <span class="post-title" title="在 Mac 下用 Docker 安装测试 HHVM">在 Mac 下用 Docker 安装测试 HHVM</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2017-02-21-docker-summary/"
       data-tag="Docker"
       data-author="" >
        <span class="post-title" title="Docker 使用总结">Docker 使用总结</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-04-19-design-patterns-of-php/"
       data-tag="PHP,Pattern"
       data-author="" >
        <span class="post-title" title="设计模式详解及PHP实现">设计模式详解及PHP实现</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
</nav>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-tech/2013-06-12-hacking-in-openstack-ceilometer-api" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">OpenStack Ceilometer数据与API源码详解</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
            <a href="javascript:" data-rel="技术">技术</a>
            
        </span>
        
        
        <span class="tag">
            
            <a href="javascript:" class="color5">OpenStack</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2017-06-20 14:35:12'>2017-06-20 15:24</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv"></span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区"><a href="#comments">评论:<span class="count-comment"></span></a></span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB的Collections"><span class="toc-text">MongoDB的Collections</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Collector对数据库的写数据"><span class="toc-text">Collector对数据库的写数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#计量内容"><span class="toc-text">计量内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API对数据库的读操作"><span class="toc-text">API对数据库的读操作</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="MongoDB的Collections"><a href="#MongoDB的Collections" class="headerlink" title="MongoDB的Collections"></a>MongoDB的Collections</h3><p>Ceilometer在MongoDB中共有这么几个Collections</p>
<pre><code>- user
  - { _id: user id
      source: [ array of source ids reporting for the user ]
      }
- project
  - { _id: project id
      source: [ array of source ids reporting for the project ]
      }
- meter
  - the raw incoming data
- resource
  - the metadata for resources
  - { _id: uuid of resource,
      metadata: metadata dictionaries
      user_id: uuid
      project_id: uuid
      meter: [ array of {counter_name: string, counter_type: string,
                         counter_unit: string} ]
    }
</code></pre><p>其中meter是采集到的数据，其他的都是固定值</p>
<h3 id="Collector对数据库的写数据"><a href="#Collector对数据库的写数据" class="headerlink" title="Collector对数据库的写数据"></a>Collector对数据库的写数据</h3><p>Collector在接收到采集的数据后，会调用<code>record_metering_data()</code>对数据进行写入，相应mongodb的代码在<code>ceilometer.storage.impl_mongodb</code>中</p>
<pre><code>def record_metering_data(self, data):
    self.db.user.update(
        {&apos;_id&apos;: data[&apos;user_id&apos;]},
        {&apos;$addToSet&apos;: {&apos;source&apos;: data[&apos;source&apos;],},},
        upsert=True,
    )
    self.db.project.update(
        {&apos;_id&apos;: data[&apos;project_id&apos;]},
        {&apos;$addToSet&apos;: {&apos;source&apos;: data[&apos;source&apos;],},},
        upsert=True,
    )

    self.db.resource.update(
        {&apos;_id&apos;: data[&apos;resource_id&apos;]},
        {&apos;$set&apos;: {&apos;project_id&apos;: data[&apos;project_id&apos;],
                  &apos;user_id&apos;: data[&apos;user_id&apos;],
                  &apos;metadata&apos;: data[&apos;resource_metadata&apos;],
                  &apos;source&apos;: data[&apos;source&apos;],},
         &apos;$addToSet&apos;: {&apos;meter&apos;: {&apos;counter_name&apos;: data[&apos;counter_name&apos;],
                                 &apos;counter_type&apos;: data[&apos;counter_type&apos;],
                                 &apos;counter_unit&apos;: data[&apos;counter_unit&apos;],},},
         },
        upsert=True,
    )

    record = copy.copy(data)
    self.db.meter.insert(record)
    return
</code></pre><p>从上面代码可知，每次存储时都会更新user,project和resource，然后将数据完全写入到meter中，写入后的数据格式如下：</p>
<pre><code>{
  &quot;counter_name&quot;: &quot;disk.write.requests&quot;,
  &quot;user_id&quot;: &quot;4ff44f4665564b2abcb8e1f1619f2b85&quot;,
  &quot;message_signature&quot;: &quot;8473976666aecd078a281afed936839b737ceaf4bb63654759d63514bdc9ee03&quot;,
  &quot;timestamp&quot;: ISODate(&quot;2013-05-21T22:33:14.0Z&quot;),
  &quot;resource_id&quot;: &quot;b7fc623d-1d4a-4ac7-b96b-78c9d921fa74&quot;,
  &quot;resource_metadata&quot;: {
    &quot;ramdisk_id&quot;: &quot;&quot;,
    &quot;display_name&quot;: &quot;test&quot;,
    &quot;name&quot;: &quot;instance-00000001&quot;,
    &quot;disk_gb&quot;: &quot;&quot;,
    &quot;availability_zone&quot;: &quot;&quot;,
    &quot;kernel_id&quot;: &quot;&quot;,
    &quot;ephemeral_gb&quot;: &quot;&quot;,
    &quot;host&quot;: &quot;e781ff9ce97dcc328d8826cfb19a20c001b866cb20859653c2f481b1&quot;,
    &quot;memory_mb&quot;: &quot;&quot;,
    &quot;instance_type&quot;: &quot;42&quot;,
    &quot;vcpus&quot;: &quot;&quot;,
    &quot;root_gb&quot;: &quot;&quot;,
    &quot;image_ref&quot;: &quot;da04e6dd-4cc7-4594-87d8-60927c07c396&quot;,
    &quot;architecture&quot;: &quot;&quot;,
    &quot;os_type&quot;: &quot;&quot;,
    &quot;reservation_id&quot;: &quot;&quot;,
    &quot;image_ref_url&quot;: &quot;http:\/\/192.168.0.6:8774\/676730085ab84296a9b4a7d68ee76078\/images\/da04e6dd-4cc7-4594-87d8-60927c07c396&quot;
  },
  &quot;source&quot;: &quot;openstack&quot;,
  &quot;counter_unit&quot;: &quot;request&quot;,
  &quot;counter_volume&quot;: NumberInt(1366),
  &quot;project_id&quot;: &quot;be13e080970d44b280e4843e084bb2b1&quot;,
  &quot;message_id&quot;: &quot;6cf1d76c-c266-11e2-a987-5eafb2e29593&quot;,
  &quot;counter_type&quot;: &quot;cumulative&quot;
}
</code></pre><p>这是一个disk.write.requests的数据，其中resource_metadata如果无变化的话，没个都会带这些数据，具体原因不详</p>
<p>另外，重要的东西在</p>
<ul>
<li>counter_unit 计量单位</li>
<li>counter_volume 计量数值</li>
<li>counter_type 计量类型</li>
</ul>
<h3 id="计量内容"><a href="#计量内容" class="headerlink" title="计量内容"></a>计量内容</h3><p>在<a href="http://docs.openstack.org/developer/ceilometer/measurements.html" target="_blank" rel="external">文档</a>中讲了计量值和其单位</p>
<p>首先是计量类型：</p>
<ul>
<li>Cumulative  随时间的累计值（如cpu总时长）</li>
<li>Gauge  离散项(floating IPs, image uploads)和变化的值 (disk I/O)</li>
<li>Delta  随时间的变化量（带宽等）</li>
</ul>
<p>计量单位比较多了，每个都不太一样，这个可以查询文档，如磁盘读写请求的单位为”request”</p>
<h3 id="API对数据库的读操作"><a href="#API对数据库的读操作" class="headerlink" title="API对数据库的读操作"></a>API对数据库的读操作</h3><p>数据存储只是Ceilometer的一小部分，如果合理的利用和分析采集到的数据才比较重要，另外这部分也是暴露出来给开发者的部分</p>
<p>API服务以wsgi service方式运行在后端，Ceilometer有v1和v2两个版本的API，v1会被弃用，这里只讲v2部分</p>
<pre><code>GET /v2/meters/cpu?q.op=ge&amp;q.op=lt&amp;q.op=eq&amp;q.value=2013-05-19+23%3A00%3A00&amp;q.value=2013-05-20+00%3A00%3A00&amp;q.value=b7fc623d-1d4a-4ac7-b96b-78c9d921fa74&amp;q.field=timestamp&amp;q.field=timestamp&amp;q.field=resource
</code></pre><p>这是一个我截取下来的请求，首先我们看到一个资源地址</p>
<pre><code>GET /v2/meters/cpu
</code></pre><p>根据V2的Controller，我们可以看到是MetersController()对它进行处理的</p>
<pre><code>class V2Controller(object):
    resources = ResourcesController()
    meters = MetersController()
    alarms = AlarmsController()
</code></pre>
      
    </div>
</article>

<p>
    <a href="javascript:void(0)" class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span>文章标题:</span>OpenStack Ceilometer数据与API源码详解</p>
    
    <p><span>本文作者:</span><a href="javascript:void(0)" title="Allen">Allen</a></p>
    <p><span>发布时间:</span>2017-06-20, 15:24:10</p>
    <p><span>最后更新:</span>2017-06-20, 14:35:12</p>
    <span>原始链接:</span><a class="post-url" href="/2017/06/20/tech/2013-06-12-hacking-in-openstack-ceilometer-api/" title="OpenStack Ceilometer数据与API源码详解">https://9allenzhao.github.io/2017/06/20/tech/2013-06-12-hacking-in-openstack-ceilometer-api/</a>
    <p>
        <span>版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>


    

    </div>
    <div class="copyright">
        <p class="footer-entry">©2017 Yelog</p>
<p class="footer-entry">Buit with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
</div>
<div class="full-toc">
    <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" href="javascript:void(0)"></a>
</div>
<div class="acParent"></div>
<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>
</body>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery.pjax/1.9.6/jquery.pjax.min.js"></script>
<script src="/js/script.js"></script>
<script>
    $(function () {
        $('.search').AutoComplete({
            'data': ['#PHP','#JavaScript','#OpenStack','#Python','#Virtualization','#Concept','#HTML','#CSS','#Apache','#Git','#Nginx','#Laravel','#MySQL','#Mac','#算法','#React','#Bootstrap','#jQuery','#SVN','#Shell','#SEO','#Vim','#Windows','#Linux','#Sublime','#Jekyll','#Blog','#Tool','#MongoDB','#Tools','#Vagrant','#Docker','#Pattern',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        
            $(".post .pjax table").addClass("green_title");
        
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        
        
        
        $.getScript("//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js");
        
    }
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    
</script>

<!--自定义样式设置-->
<style>
    
    .nav-right nav a.hover{
        background-color: #e2e0e0;
    }
    
    

</style>
</html>
