<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>OpenStack Ceilometer Agent源码解读 | Allen&#39;s BLOG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Ceilometer中的Compute Agent是和虚拟机运行最紧密的一个监控代理模块，在读Ceilometer代码时，由于有Libvirt的基础，所以看起来会相对容易些">
<meta name="keywords" content="OpenStack,Ceilometer,Compute Agent,Source Code">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenStack Ceilometer Agent源码解读">
<meta property="og:url" content="http://yoursite.com/2017/06/20/tech/2013-06-11-hacking-in-openstack-ceilometer-compute-agent/index.html">
<meta property="og:site_name" content="Allen&#39;s BLOG">
<meta property="og:description" content="Ceilometer中的Compute Agent是和虚拟机运行最紧密的一个监控代理模块，在读Ceilometer代码时，由于有Libvirt的基础，所以看起来会相对容易些">
<meta property="og:updated_time" content="2017-06-20T06:35:12.402Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenStack Ceilometer Agent源码解读">
<meta name="twitter:description" content="Ceilometer中的Compute Agent是和虚拟机运行最紧密的一个监控代理模块，在读Ceilometer代码时，由于有Libvirt的基础，所以看起来会相对容易些">
  
  
    <link rel="icon" href="/img/avatar.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
  
  <link rel="stylesheet" href="/css/hl_theme/darcula.css">
  
  <link href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script src="/js/jquery.autocomplete.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
    <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
  
</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_duoshuo_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_duoshuo_domain" value="jaytp">
</div>
<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar" style="background-image:url(/img/avatar.jpg)"></a>
<div class="author">
    <span>Allen</span>
</div>
<div class="icon">
    
    <a class="rss" title="rss" href="/atom.xml" target="_blank"></a>
    
    
    
    
    
    
    
    
    
    <a class="email" title="email" href="mailto:9allenzhao@gmail.com"></a>
    
</div>
<ul>
    <li class="all active">全部文章</li>
    
    <li data-rel="读书"> 读书 </li>
    
    <li data-rel="技术"> 技术 </li>
    
    <li data-rel="资源"> 资源 </li>
    
    <li data-rel="工具"> 工具 </li>
    
</ul>
<input type="hidden" id="yelog_site_posts_number" value="107">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>
    </div>
    <div class="nav-right">
        <form onkeydown="if(event.keyCode==13){return false;}">
    <input class="search" type="text" placeholder="Search..." autocomplete="off">
    <i class="cross"></i>
    <span>
        <label for="tagswitch">Tags:</label>
        <input id="tagswitch" type="checkbox">
    </span>
</form>
<ul class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">PHP</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">JavaScript</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">Python</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">OpenStack</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Virtualization</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Concept</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">HTML</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">CSS</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">Apache</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">Git</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Laravel</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Nginx</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">MySQL</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">Mac</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">算法</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">React</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Bootstrap</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">jQuery</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Shell</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">SVN</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">SEO</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Windows</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">Vim</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Sublime</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">Jekyll</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Blog</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">MongoDB</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">Tool</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Vagrant</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Tools</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">Docker</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">Pattern</a>
    </li>
    
    <div class="clearfix"></div>
</ul>

<nav>
    
    <a  class=""
       href="/2017/06/20/hello-world/"
       data-tag=""
       data-author="" >
        <span class="post-title" title="Hello World">Hello World</span>
        <span class="post-date" title="2017-06-20 15:20:58">2017/06/20</span>
    </a>
    
    <a  class="读书 "
       href="/2017/06/20/book/2013-12-20-book-list-of-2013/"
       data-tag=""
       data-author="" >
        <span class="post-title" title="2013阅读书单">2013阅读书单</span>
        <span class="post-date" title="2017-06-20 15:23:40">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2012-09-19-php-session-security/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="PHP Session 原理及安全性提升">PHP Session 原理及安全性提升</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="读书 "
       href="/2017/06/20/book/2014-03-14-book-list-of-2014/"
       data-tag=""
       data-author="" >
        <span class="post-title" title="2014阅读书单">2014阅读书单</span>
        <span class="post-date" title="2017-06-20 15:23:40">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2012-09-27-php-variable-variables/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="PHP可变变量">PHP可变变量</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2012-09-27-open-widown-in-javascript/"
       data-tag="JavaScript"
       data-author="" >
        <span class="post-title" title="JS中防止浏览器屏蔽window.open">JS中防止浏览器屏蔽window.open</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2012-12-31-python-development-of-sae/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="sae下的python开发部署和一个简单例子">sae下的python开发部署和一个简单例子</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2012-11-08-openstack-nova-internal/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Nova内部机制【译】">OpenStack Nova内部机制【译】</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-01-30-command-of-kanyun/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="kanyun的api-client命令">kanyun的api-client命令</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-01-30-deploy-kanyun/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="在OpenStack中部署kanyun">在OpenStack中部署kanyun</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-01-30-introduction-of-kanyun-worker/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="kanyun worker原理">kanyun worker原理</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-02-24-javascript-variable-domain/"
       data-tag="JavaScript"
       data-author="" >
        <span class="post-title" title="JavaScript变量作用域">JavaScript变量作用域</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-01-30-introduction-kanyun-server/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="kanyun server服务">kanyun server服务</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-03-20-debug-and-modify-openstack-horizon/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="调试和修改OpenStack中的Horizon部分">调试和修改OpenStack中的Horizon部分</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-03-20-different-bewteen-kvm-xen-qemu/"
       data-tag="Virtualization"
       data-author="" >
        <span class="post-title" title="虚拟化中KVM, Xen, Qemu的区别">虚拟化中KVM, Xen, Qemu的区别</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-03-21-vnc-vs-rdp/"
       data-tag="Virtualization"
       data-author="" >
        <span class="post-title" title="VNC和远程桌面的区别">VNC和远程桌面的区别</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-03-21-introduction-of-ceilometer/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Ceilometer项目简介">OpenStack Ceilometer项目简介</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-03-27-glossary-of-ceilometer/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Ceilometer的一些术语">OpenStack Ceilometer的一些术语</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-04-23-opensource-licenses/"
       data-tag="Concept"
       data-author="" >
        <span class="post-title" title="五种常见的开源协议整理">五种常见的开源协议整理</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-04-25-conceptual-logical-physical/"
       data-tag="Concept"
       data-author="" >
        <span class="post-title" title="概念模型、逻辑模型、物理模型的区别">概念模型、逻辑模型、物理模型的区别</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-04-25-some-concept-about-enterprise-storage/"
       data-tag="Concept"
       data-author="" >
        <span class="post-title" title="几种企业的存储系统">几种企业的存储系统</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-04-26-create-windows-xp-image-for-openstack/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="给OpenStack创建Windows XP镜像">给OpenStack创建Windows XP镜像</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-01-deploy-a-ceilometer-horizon-project/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="部署一个ceilometer-horizon项目">部署一个ceilometer-horizon项目</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-03-create-windows-7-image-for-openstack/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="给OpenStack创建Win7镜像">给OpenStack创建Win7镜像</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-03-php-cache-of-a-page/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="页面提速之——数据缓存">页面提速之——数据缓存</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-01-terminal-command-of-ceilometer/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="Ceilometer的命令行使用">Ceilometer的命令行使用</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-06-interactive-coding-ipython/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="交互式编程-IPython">交互式编程-IPython</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-06-the-viewpoint-metatag/"
       data-tag="HTML"
       data-author="" >
        <span class="post-title" title="HTML中meta标签viewpoint的作用">HTML中meta标签viewpoint的作用</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-06-why-use-pip-over-easy-install/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="为什么使用pip而不是easy_install">为什么使用pip而不是easy_install</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-13-openstack-grizzly-multihost-deployment-doc/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Grizzly Multihost部署文档">OpenStack Grizzly Multihost部署文档</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-15-different-between-python-package-tools/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="python包工具之间的关系">python包工具之间的关系</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-15-create-ubuntu-image-for-openstack/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="给OpenStack创建Ubuntu镜像">给OpenStack创建Ubuntu镜像</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-15-learn-how-to-use-distutils/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="学习使用python打包工具distutils">学习使用python打包工具distutils</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-19-what-is-wsgi/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="WSGI学习">WSGI学习</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-16-deploy-openstack-grizzly-in-virtual-machine/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="在虚拟机单机部署OpenStack Grizzly">在虚拟机单机部署OpenStack Grizzly</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-05-27-openstack-horizon-locale/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Horizon 中文本地化">OpenStack Horizon 中文本地化</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-07-learn-python-setuptools-in-detail/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="Python包管理工具setuptools详解">Python包管理工具setuptools详解</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-09-learn-python-abc-module/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="学习Python的ABC模块">学习Python的ABC模块</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-09-learn-python-stevedore-module-in-detail/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="学习Python动态扩展包stevedore">学习Python动态扩展包stevedore</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-11-hacking-in-openstack-ceilometer-compute-agent/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Ceilometer Agent源码解读">OpenStack Ceilometer Agent源码解读</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-11-pipeline-of-openstack-ceilometer/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Ceilometer Pipeline代码解读">OpenStack Ceilometer Pipeline代码解读</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-12-hacking-in-openstack-ceilometer-collector/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Ceilometer Collector代码解读">OpenStack Ceilometer Collector代码解读</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-06-12-hacking-in-openstack-ceilometer-api/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="OpenStack Ceilometer数据与API源码详解">OpenStack Ceilometer数据与API源码详解</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-10-01-deploy-ceilometer-of-openstack/"
       data-tag="OpenStack"
       data-author="" >
        <span class="post-title" title="部署Ceilometer到已有环境中">部署Ceilometer到已有环境中</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2013-12-08-implemention-of-breadcrumbs-by-css3/"
       data-tag="CSS"
       data-author="" >
        <span class="post-title" title="基于CSS3实现尖角面包屑">基于CSS3实现尖角面包屑</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-01-24-apache-log-format/"
       data-tag="Apache"
       data-author="" >
        <span class="post-title" title="Apache 日志文件格式及简单处理">Apache 日志文件格式及简单处理</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-01-16-php-namespace-and-autoload/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="PHP命名空间及自动加载">PHP命名空间及自动加载</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-01-17-python-script-of-sae-log-download/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="Python脚本--下载合并SAE日志">Python脚本--下载合并SAE日志</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-01-25-how-to-use-php-socket/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="PHP Socket的使用">PHP Socket的使用</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-01-30-understanding-the-github-workflow/"
       data-tag="Git"
       data-author="" >
        <span class="post-title" title="了解GitHub工作流【译】">了解GitHub工作流【译】</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-03-10-grunt-bower-and-laravel/"
       data-tag="PHP,Laravel"
       data-author="" >
        <span class="post-title" title="用Laravel+Grunt+Bower管理你的应用">用Laravel+Grunt+Bower管理你的应用</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-02-15-apache-and-nginx/"
       data-tag="Apache,Nginx"
       data-author="" >
        <span class="post-title" title="从运行原理及使用场景看Apache和Nginx">从运行原理及使用场景看Apache和Nginx</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-03-20-use-other-libraries-in-laravel/"
       data-tag="PHP,Laravel"
       data-author="" >
        <span class="post-title" title="在Laravel中使用自己的类库三种方式">在Laravel中使用自己的类库三种方式</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-03-22-managing-your-larrvel-queue-by-supervisor/"
       data-tag="PHP,Laravel"
       data-author="" >
        <span class="post-title" title="使用Supervisor来管理你的Laravel队列">使用Supervisor来管理你的Laravel队列</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-04-11-redis-queue-in-laravel/"
       data-tag="Laravel"
       data-author="" >
        <span class="post-title" title="Laravel中用Redis来做任务队列">Laravel中用Redis来做任务队列</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-04-16-insert-large-number-of-data-in-mysql/"
       data-tag="MySQL"
       data-author="" >
        <span class="post-title" title="MySQL大量数据插入方法性能分析比较">MySQL大量数据插入方法性能分析比较</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-04-23-roc-curve/"
       data-tag="Concept"
       data-author="" >
        <span class="post-title" title="ROC曲线">ROC曲线</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-04-27-magic-methods-and-magic-constants-in-php/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="PHP中的魔术方法和魔术常量简介和使用">PHP中的魔术方法和魔术常量简介和使用</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-05-04-set-environment-variables-of-server-for-php/"
       data-tag="PHP,Apache,Nginx"
       data-author="" >
        <span class="post-title" title="设置PHP服务器Apache和Nginx环境变量">设置PHP服务器Apache和Nginx环境变量</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-12-06-ioc-and-facade-in-laravel/"
       data-tag="PHP,Laravel"
       data-author="" >
        <span class="post-title" title="Laravel核心之IOC和Facade">Laravel核心之IOC和Facade</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-09-26-use-old-version-of-brew-php/"
       data-tag="PHP,Mac"
       data-author="" >
        <span class="post-title" title="回退Mac上用Brew安装的PHP版本">回退Mac上用Brew安装的PHP版本</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2015-01-08-conflict-between-camel-and-snake-in-laravel/"
       data-tag="PHP,Laravel"
       data-author="" >
        <span class="post-title" title="Laravel关联模型名称一致性问题">Laravel关联模型名称一致性问题</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2015-09-07-sort-algorithms/"
       data-tag="算法"
       data-author="" >
        <span class="post-title" title="七种常见经典排序算法总结（C++实现）">七种常见经典排序算法总结（C++实现）</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2017-02-19-setup-react-environment/"
       data-tag="React"
       data-author="" >
        <span class="post-title" title="React 学习 - 开发环境搭建">React 学习 - 开发环境搭建</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2013-04-23-general-bootstrap-resources/"
       data-tag="Bootstrap"
       data-author="" >
        <span class="post-title" title="Bootstrap常用资源">Bootstrap常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-git-resources/"
       data-tag="Git"
       data-author="" >
        <span class="post-title" title="Git 常用资源">Git 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-html-resources/"
       data-tag="HTML"
       data-author="" >
        <span class="post-title" title="HTML 常用资源">HTML 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-javascript-resources/"
       data-tag="JavaScript"
       data-author="" >
        <span class="post-title" title="JavaScript 常用资源">JavaScript 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-php-resources/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="PHP 常用资源">PHP 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-jquery-resources/"
       data-tag="jQuery"
       data-author="" >
        <span class="post-title" title="jQuery 常用资源">jQuery 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-shell-resources/"
       data-tag="Shell"
       data-author="" >
        <span class="post-title" title="Shell 常用资源">Shell 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-python-resources/"
       data-tag="Python"
       data-author="" >
        <span class="post-title" title="Python 常用资源">Python 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-01-15-general-svn-resources/"
       data-tag="SVN"
       data-author="" >
        <span class="post-title" title="SVN 常用资源">SVN 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-05-11-general-mysql-resources/"
       data-tag="MySQL"
       data-author="" >
        <span class="post-title" title="MySQL常用资源">MySQL常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2014-08-03-general-mac-resources/"
       data-tag="Mac"
       data-author="" >
        <span class="post-title" title="Mac 常用资源">Mac 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2015-02-13-general-seo-resources/"
       data-tag="SEO"
       data-author="" >
        <span class="post-title" title="SEO 常用资源">SEO 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2012-12-30-share-windows-and-linux/"
       data-tag="Windows,Linux"
       data-author="" >
        <span class="post-title" title="Windows和Linux切换最终解决方案">Windows和Linux切换最终解决方案</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="资源 "
       href="/2017/06/20/resource/2015-10-04-general-vim-resources/"
       data-tag="Vim"
       data-author="" >
        <span class="post-title" title="Vim 常用资源">Vim 常用资源</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-01-09-remote-access-of-mysql/"
       data-tag="MySQL"
       data-author="" >
        <span class="post-title" title="MySQL远程访问">MySQL远程访问</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-02-25-quick-open-in-windows/"
       data-tag="Windows"
       data-author="" >
        <span class="post-title" title="win7快速打开应用程序或文件">win7快速打开应用程序或文件</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-01-16-create-remote-resp/"
       data-tag="Git"
       data-author="" >
        <span class="post-title" title="git创建远程库">git创建远程库</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-03-25-open-tcp-port-of-libvirt/"
       data-tag="Linux"
       data-author="" >
        <span class="post-title" title="Linux下开启Libvirtd的tcp监控">Linux下开启Libvirtd的tcp监控</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-04-21-add-snippet/"
       data-tag="Sublime"
       data-author="" >
        <span class="post-title" title="给sublime增加snippet">给sublime增加snippet</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-03-25-tools-of-sever-deployment/"
       data-tag="Linux"
       data-author="" >
        <span class="post-title" title="服务器自动化部署及运维常见工具">服务器自动化部署及运维常见工具</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-04-22-add-svn-ignore-file/"
       data-tag="SVN"
       data-author="" >
        <span class="post-title" title="给SVN控制的项目添加忽略文件/文件夹">给SVN控制的项目添加忽略文件/文件夹</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-04-22-highlight-of-jekyll/"
       data-tag="Jekyll"
       data-author="" >
        <span class="post-title" title="Jekyll的中的代码高亮">Jekyll的中的代码高亮</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-04-22-ignore-password-in-git-push/"
       data-tag="Git"
       data-author="" >
        <span class="post-title" title="让git push命令不再需要密码">让git push命令不再需要密码</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-04-22-wordpress-to-jekyll/"
       data-tag="Blog"
       data-author="" >
        <span class="post-title" title="博客迁移完成">博客迁移完成</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-05-20-set-proxy-for-git-or-apt/"
       data-tag="Git"
       data-author="" >
        <span class="post-title" title="给Git或者APT设置goagent代理">给Git或者APT设置goagent代理</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-05-22-change-to-zsh/"
       data-tag="Mac"
       data-author="" >
        <span class="post-title" title="从Bash切换到Zsh">从Bash切换到Zsh</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-05-23-install-mysql-and-mongo-web-admin/"
       data-tag="MySQL,Linux,MongoDB"
       data-author="" >
        <span class="post-title" title="安装MySQL和MongoDB的WEB管理界面">安装MySQL和MongoDB的WEB管理界面</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-08-04-something-about-tools-i-used/"
       data-tag="Tool"
       data-author="" >
        <span class="post-title" title="我与工具">我与工具</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-08-06-tools-of-reading/"
       data-tag="Tool"
       data-author="" >
        <span class="post-title" title="我与工具--阅读和知识管理">我与工具--阅读和知识管理</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-12-08-linux-command-continue/"
       data-tag="Linux"
       data-author="" >
        <span class="post-title" title="Linux下多个命令连续执行方法">Linux下多个命令连续执行方法</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-08-28-change-bootstrap-to-3/"
       data-tag="Blog"
       data-author="" >
        <span class="post-title" title="更新前端框架到Bootstrap3">更新前端框架到Bootstrap3</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-12-11-deploy-pptp-vpn-in-ubuntu/"
       data-tag="Linux"
       data-author="" >
        <span class="post-title" title="在ubuntu下搭建pptp vpn服务器">在ubuntu下搭建pptp vpn服务器</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2014-03-20-php-debug-with-xdebug/"
       data-tag="PHP"
       data-author="" >
        <span class="post-title" title="用Xdebug和Sublime调试PHP代码">用Xdebug和Sublime调试PHP代码</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2013-12-11-lamp-in-mac/"
       data-tag="PHP,Mac,MongoDB"
       data-author="" >
        <span class="post-title" title="Mac下用brew搭建LNMP和LAMP开发环境">Mac下用brew搭建LNMP和LAMP开发环境</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2014-02-12-how-to-deploy-a-blog-on-github-by-jekyll/"
       data-tag="Jekyll"
       data-author="" >
        <span class="post-title" title="在Github上搭建Jekyll博客和创建主题">在Github上搭建Jekyll博客和创建主题</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2014-04-10-install-vagrant-in-mac/"
       data-tag="Mac,Vagrant"
       data-author="" >
        <span class="post-title" title="在Mac下安装使用Vagrant">在Mac下安装使用Vagrant</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2015-01-10-use-dropzone-and-qiniu-to-store-blog-images/"
       data-tag="Blog"
       data-author="" >
        <span class="post-title" title="使用Dropzone和七牛优化博客图床">使用Dropzone和七牛优化博客图床</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2016-11-09-my-writing-tools/"
       data-tag="Tools"
       data-author="" >
        <span class="post-title" title="我使用的收藏，写作和分享工具">我使用的收藏，写作和分享工具</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2016-12-30-deploy-l2tp-on-ubuntu/"
       data-tag="Tools"
       data-author="" >
        <span class="post-title" title="在 Ubuntu 下部署 L2TP VPN">在 Ubuntu 下部署 L2TP VPN</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2016-12-31-deploy-shadowsocks-on-ubuntu/"
       data-tag="Tools"
       data-author="" >
        <span class="post-title" title="在 Ubuntu 下部署 Shadowsocks">在 Ubuntu 下部署 Shadowsocks</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2017-01-14-install-hhvm-on-mac-with-docker/"
       data-tag="Mac,Docker"
       data-author="" >
        <span class="post-title" title="在 Mac 下用 Docker 安装测试 HHVM">在 Mac 下用 Docker 安装测试 HHVM</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="工具 "
       href="/2017/06/20/tool/2017-02-21-docker-summary/"
       data-tag="Docker"
       data-author="" >
        <span class="post-title" title="Docker 使用总结">Docker 使用总结</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
    <a  class="技术 "
       href="/2017/06/20/tech/2014-04-19-design-patterns-of-php/"
       data-tag="PHP,Pattern"
       data-author="" >
        <span class="post-title" title="设计模式详解及PHP实现">设计模式详解及PHP实现</span>
        <span class="post-date" title="2017-06-20 15:24:10">2017/06/20</span>
    </a>
    
</nav>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-tech/2013-06-11-hacking-in-openstack-ceilometer-compute-agent" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">OpenStack Ceilometer Agent源码解读</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
            <a href="javascript:" data-rel="技术">技术</a>
            
        </span>
        
        
        <span class="tag">
            
            <a href="javascript:" class="color5">OpenStack</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2017-06-20 14:35:12'>2017-06-20 15:24</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv"></span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区"><a href="#comments">评论:<span class="count-comment"></span></a></span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Compute-Agent功能"><span class="toc-text">Compute Agent功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#入口文件"><span class="toc-text">入口文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#入口函数"><span class="toc-text">入口函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#agent-py"><span class="toc-text">agent.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pollsters-py"><span class="toc-text">pollsters.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#inspector-py"><span class="toc-text">inspector.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TODO"><span class="toc-text">TODO</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Compute-Agent功能"><a href="#Compute-Agent功能" class="headerlink" title="Compute Agent功能"></a>Compute Agent功能</h3><p>不知道代码干了什么就盲目去读的话，基本是事倍功半的结果。</p>
<p>Ceilometer通过Agent模块去polling虚拟机或者OpenStack中需要的信息，然后将它传送至Ceilometer Event Bus中去。对于虚拟机的具体信息（CPU，Memory,Disk I/O,Network I/O）需要去虚拟机所运行的节点上获取（其实使用libvirt可以直接tcp到哪个节点上），所以需要将Agent模块丢到计算机点上，然后通过Libvirt获取虚拟机状态，这就是Compute Agent的功能。</p>
<h3 id="入口文件"><a href="#入口文件" class="headerlink" title="入口文件"></a>入口文件</h3><p>Compute Agent以OpenStack Service（OpenStack服务分为Service和WSGI Service）的形式运行在计算节点上，它由一个可执行文件开启，这个可执行文件安装时生成（目前最新版本，比Grizzly新比Havana旧……）。如果是Grizzly版本，可以去<code>ceilometer/bin</code>下找<code>ceilometer-agent-compute</code>文件，如果是和我用的一样，选最新版本，就直接看<code>ceilometer/setup.cfg</code>文件</p>
<pre><code>console_scripts =
    ceilometer-agent-central = ceilometer.central.manager:agent_central
    ceilometer-agent-compute = ceilometer.compute.manager:agent_compute
    ceilometer-dbsync = ceilometer.storage:dbsync
    ceilometer-collector = ceilometer.collector.service:collector
    ceilometer-collector-udp = ceilometer.collector.service:udp_collector
</code></pre><p>这里表明ceilometer-agent-compute从<code>ceilometer.compute.manager:agent_compute</code>运行</p>
<h3 id="入口函数"><a href="#入口函数" class="headerlink" title="入口函数"></a>入口函数</h3><p>入口函数很简单，基本就把compute的功能写清楚了，我这个版本在<code>ceilometer/ceilometer/compute/manager.py</code>中</p>
<pre><code>def agent_compute():
    eventlet.monkey_patch()
    gettextutils.install(&apos;ceilometer&apos;)
    service.prepare_service(sys.argv)
    os_service.launch(rpc_service.Service(cfg.CONF.host,
                                          &apos;ceilometer.agent.compute&apos;,
                                          AgentManager())).wait()
</code></pre><p>前4行都是准备步骤，包括参数获取等功能，真正实现功能的是最后一行</p>
<pre><code>os_service.launch(rpc_service.Service(cfg.CONF.host,&apos;ceilometer.agent.compute&apos;,AgentManager())).wait()
</code></pre><p>我再把它展开</p>
<pre><code>ceilometer.openstack.common.service.launch(
    ceilometer.openstack.common.rpc.service.Service(
        cfg.CONF.host,&apos;ceilometer.agent.compute&apos;,AgentManager()
        )
    ).wait()
</code></pre><p>两个Service函数的作用都是OpenStack服务的基本作用————启动一个服务（关于服务我有时间再详细写一个分析服务的博客），然后启动服务后，执行AgentManager()（它继承自<code>ceilometer.agent.AgentManager</code>）中的<code>initialize_service_hook()</code>函数</p>
<h3 id="agent-py"><a href="#agent-py" class="headerlink" title="agent.py"></a>agent.py</h3><p>这个模块中包含了非常重要的两个类<code>AgentManager</code>和<code>PollingTask</code>，Compute Agent和Central Agent的Manager都继承自AgentManger</p>
<p>在AgentManager的构造函数中，有这么一句</p>
<pre><code>self.pollster_manager = extension_manager
</code></pre><p>它是一种动态加载模块的机制(见<a href="/2013/06/09/learn-python-stevedore-module-in-detail.html">学习Python动态扩展包stevedore</a>)，它将载入所有它可以用来获取虚拟机状态的模块。在Compute Agent的构造函数中说明了是<code>namespace=&#39;ceilometer.poll.compute&#39;</code>，即<code>setup.cfg</code>中的：</p>
<pre><code>ceilometer.poll.compute =
    diskio = ceilometer.compute.pollsters:DiskIOPollster
    cpu = ceilometer.compute.pollsters:CPUPollster
    net = ceilometer.compute.pollsters:NetPollster
    instance = ceilometer.compute.pollsters:InstancePollster
</code></pre><p>这样就让Agent明白了它要调用哪些Pollster来获取虚拟机信息</p>
<p>构造函数中还有一个很重要的东西</p>
<pre><code>self._inspector = virt_inspector.get_hypervisor_inspector()
</code></pre><p>inspector的作用是获取虚拟机信息的，它现在只有一种实现方式—Libvirt</p>
<p>接着是启动服务时运行的那个函数<code>initialize_service_hook()</code>了</p>
<pre><code>def initialize_service_hook(self, service):
    self.service = service
    for interval, task in self.setup_polling_tasks().iteritems():
        self.service.tg.add_timer(interval,
                                  self.interval_task,
                                  task=task)
</code></pre><p>大概看一下这个函数，它利用<code>setup_polling_tasks()</code>返回的迭代器（interval是间隔时长，task是执行的任务），将interval_task(task)以interval的间隔执行</p>
<pre><code>def interval_task(self, task):
    task.poll_and_publish()
</code></pre><p>那么task是什么呢？这个就是前面提到的<code>PollingTask</code>类了，Compute Agent的PollingTask在<code>manager.py</code>文件中</p>
<pre><code>class PollingTask(agent.PollingTask):
    def poll_and_publish_instances(self, instances):
        with self.publish_context as publisher:
            for instance in instances:
                if getattr(instance, &apos;OS-EXT-STS:vm_state&apos;, None) != &apos;error&apos;:
                    for pollster in self.pollsters:
                        publisher(list(pollster.obj.get_counters(self.manager,instance)))

    def poll_and_publish(self):
        self.poll_and_publish_instances(
            self.manager.nv.instance_get_all_by_host(cfg.CONF.host))
</code></pre><p>我只写了摘了必要部分，<code>poll_and_publish</code>通过nova_client获得现有的所有虚拟机，然后调用<code>poll_and_pusblish_instances</code></p>
<p>通过pollster.get_counters获得虚拟机的数据，然后通过pipeline将数据转换和传送给publisher，由publisher发送到MQ中去。这里涉及到的pipeline和publisher单独拿出来研究，之后再写。</p>
<h3 id="pollsters-py"><a href="#pollsters-py" class="headerlink" title="pollsters.py"></a>pollsters.py</h3><p>这个文件位于<code>ceilometer/ceilometer/compute</code>下，它是轮询虚拟机信息的主要代码所在</p>
<p>以cpu为例说明</p>
<pre><code>class CPUPollster(plugin.ComputePollster):
    def get_counters(self, manager, instance):
        instance_name = _instance_name(instance)
        cpu_info = manager.inspector.inspect_cpus(instance_name)
        yield make_counter_from_instance(instance,
                                         name=&apos;cpu&apos;,
                                         type=counter.TYPE_CUMULATIVE,
                                         unit=&apos;ns&apos;,
                                         volume=cpu_info.time,
                                         )
</code></pre><p>这里省略了大部分代码，只是给出一个Pollster的写法，它需要一个get_counters的函数，用来返回货取到的虚拟机数据。执行获取的代码来自于inspector，也就是<code>ceilometer/ceilometer/compute/virt/inspector.py</code>中的功能了</p>
<h3 id="inspector-py"><a href="#inspector-py" class="headerlink" title="inspector.py"></a>inspector.py</h3><p>inspector要做的就是去获得虚拟机数据了，它可以有多重方式，暂时ceilometer只写了基于libvirt获得的。暂时inspector可以做的内容主要有一下几个：</p>
<pre><code>def inspect_instances(self):
def inspect_cpus(self, instance_name):
def inspect_vnics(self, instance_name):
def inspect_disks(self, instance_name):
</code></pre><p>通过Libvirt获得虚拟机信息方法应该在之前讲<a href="/2013/01/30/introduction-of-kanyun-worker.html">kanyun worker原理</a>的时候说到了，再这里就不赘述了</p>
<h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><p>基本先写到这里，对于了解Compute Agent代码运行机制，对它进行二次开发也有很大帮助，再有内容以后再补充</p>

      
    </div>
</article>

<p>
    <a href="javascript:void(0)" class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span>文章标题:</span>OpenStack Ceilometer Agent源码解读</p>
    
    <p><span>本文作者:</span><a href="javascript:void(0)" title="Allen">Allen</a></p>
    <p><span>发布时间:</span>2017-06-20, 15:24:10</p>
    <p><span>最后更新:</span>2017-06-20, 14:35:12</p>
    <span>原始链接:</span><a class="post-url" href="/2017/06/20/tech/2013-06-11-hacking-in-openstack-ceilometer-compute-agent/" title="OpenStack Ceilometer Agent源码解读">http://yoursite.com/2017/06/20/tech/2013-06-11-hacking-in-openstack-ceilometer-compute-agent/</a>
    <p>
        <span>版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>


    

    </div>
    <div class="copyright">
        <p class="footer-entry">©2017 Yelog</p>
<p class="footer-entry">Buit with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
</div>
<div class="full-toc">
    <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" href="javascript:void(0)"></a>
</div>
<div class="acParent"></div>
<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>
</body>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery.pjax/1.9.6/jquery.pjax.min.js"></script>
<script src="/js/script.js"></script>
<script>
    $(function () {
        $('.search').AutoComplete({
            'data': ['#PHP','#JavaScript','#Python','#OpenStack','#Virtualization','#Concept','#HTML','#CSS','#Apache','#Git','#Laravel','#Nginx','#MySQL','#Mac','#算法','#React','#Bootstrap','#jQuery','#Shell','#SVN','#SEO','#Windows','#Linux','#Vim','#Sublime','#Jekyll','#Blog','#MongoDB','#Tool','#Vagrant','#Tools','#Docker','#Pattern',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        
            $(".post .pjax table").addClass("green_title");
        
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        
        
        
        $.getScript("//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js");
        
    }
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    
</script>

<!--自定义样式设置-->
<style>
    
    .nav-right nav a.hover{
        background-color: #e2e0e0;
    }
    
    

</style>
</html>
